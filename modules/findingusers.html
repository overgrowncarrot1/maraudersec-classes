<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finding Users</title>
    <link rel="stylesheet" href="../styles.css"> <!-- Adjust the path as needed -->
</head>
<body>

    <div class="content">
        <h2>Finding Users</h2>
        <p>Usually you would find users through OSINT, looking at web pages, phonebook.cz, LinkedIn, Facebook, Twitter or whatever it is called at this time.</p>
        <p>For this area we will not be looking at OSINT, we will be looking at different ways to find users from PowerShell or through Linux due to insecure practices.</p>
        <p>If you have access to a machine there are multiple ways to find users on a domain, one of those ways is using the .net framework. This will work on both machines and servers.</p>
        <p>Depending on your permissions, and what modules are loaded, you may not be able to use some of the tools below, or you may see different information.</p>

        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   
        net user /domain
                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>

        <p>To see all users and some useful information about them we can run the following command. You will receive an error at the end due to how PowerShell thinks that there is a user, user.</p>

        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   

# Get a list of all users in the domain (replace with local if needed)
$users = (net user /domain) -split '\r?\n' | Where-Object { $_ -match '^\S' -and $_ -notmatch '^User accounts for' -and $_ -notmatch '^-+' -and $_ -notmatch "The command completed successfully" }

# Flatten the list if multiple usernames are found on one line
$users = $users -join ' ' -split '\s+'  # This will split all usernames into a single list

# Loop through each user and print useful information
foreach ($user in $users) {
    Write-Host "`nFetching information for user: $user"
    
    # Get user info (account status, password expiry, last logon, etc.)
    $userInfo = net user $user /domain 2>&1  # Redirecting errors to handle any missing user info gracefully

    # Check if userInfo is empty or null, indicating that the user might not exist
    if (-not $userInfo -or $userInfo -match "does not exist") {
        Write-Host "Error: $user does not exist or is not valid."
        continue
    }

    # Extract relevant information (with additional null checks)
    $isActive = $null
    $lastLogon = $null
    $passwordExpires = $null
    $groups = $null

    # Try to extract each piece of information with a null check
    $isActive = ($userInfo | Select-String -Pattern "Account active" | ForEach-Object { $_.Line -replace "Account active\s+", "" }).Trim()
    $lastLogon = ($userInfo | Select-String -Pattern "Last logon" | ForEach-Object { $_.Line -replace "Last logon\s+", "" }).Trim()
    $passwordExpires = ($userInfo | Select-String -Pattern "Password expires" | ForEach-Object { $_.Line -replace "Password expires\s+", "" }).Trim()
    $groups = ($userInfo | Select-String -Pattern "Group" | ForEach-Object { $_.Line -replace "Group\s+", "" }).Trim()

    # Ensure we set "N/A" if information is missing
    if (-not $isActive) { $isActive = "N/A" }
    if (-not $lastLogon) { $lastLogon = "N/A" }
    if (-not $passwordExpires) { $passwordExpires = "N/A" }
    if (-not $groups) { $groups = "N/A" }

    # Output the extracted information
    Write-Host "User: $user"
    Write-Host "Account Active: $isActive"
    Write-Host "Last Logon: $lastLogon"
    Write-Host "Password Expires: $passwordExpires"
    Write-Host "Groups: $($groups -join ', ')"
}

                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>

        <p>Now that we have some good information on users, lets look at dsquery.</p>
        <p>DSQuery may not be used on all machines, usually only servers have dsquery commands in them.</p>
        
        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   

dsquery user -limit 0 | dsget user -dn | ForEach-Object { ($_ -split ',')[0] -replace 'CN=', '' }

                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>
    
        <p>Utilizing LDAP we can also find users.</p>
  
        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   
Get-ADUser -Filter * -Properties SamAccountName | Select-Object SamAccountName

                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>
        
        <p>We can also search for users utilizing RPC</p>

        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   
# Import the Active Directory module if not already imported
Import-Module ActiveDirectory

# Get all user accounts from Active Directory
$users = Get-ADUser -Filter * -Properties * -Server "maraudersec.local"

# Loop through each user and display their information
foreach ($user in $users) {
    Write-Host "User: $($user.SamAccountName)"
    Write-Host "Name: $($user.Name)"
    Write-Host "Display Name: $($user.DisplayName)"
    Write-Host "Email: $($user.EmailAddress)"
    Write-Host "Last Logon: $($user.LastLogonDate)"
    Write-Host "Account Status: $($user.Enabled)"
    Write-Host "-----------------------------------"
}
                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>

        <p>There is another way to find users, especially if you were using OSINT. When using OSINT you will not see a username, so using a username mashup script from GitHub usually works best.</p>
        <p>After you have mashed up the usernames you have found you can utilize Kerbrute to see if usernames exist. If they do you can figure out how the usernames are created, such as first.last, or first intial.last and so on.</p>
        <p>We will download Kerbrute onto our Windows machine and attempt to find some usernames, the username list that we are going to use is located at https://raw.githubusercontent.com/overgrowncarrot1/maraudersec-classes/refs/heads/main/tools/usernames.txt</p>
        <p>We can download the username list onto the windows machine with:</p>  
        
        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>   
            
            wget https://raw.githubusercontent.com/overgrowncarrot1/maraudersec-classes/refs/heads/main/tools/usernames.txt -o usernames.txt

                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>

        <p>We also need to download Kerbrute we can do that with:</p>

        <div class="powershell-terminal-wrapper">
            <div class="powershell-terminal">
                <div class="terminal-header">
                    <span>PowerShell Terminal</span>
                    <div class="terminal-controls">
                        <button class="minimize">-</button>
                        <button class="maximize">+</button>
                        <button class="close">X</button>
                    </div>
                </div>
                <pre>
        wget https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_amd64.exe -o kerbrute.exe
     
                </pre>
                <button class="copy-btn" onclick="copyToClipboard()">Copy</button>
            </div>
        </div>
                    
        <div class="image-container">
            <img src="../images/image_2.jpg" alt="ISO Image">
        </div>

 
    </div>

    <script src="script.js"></script> <!-- Link to your JavaScript file -->
</body>
</html>
